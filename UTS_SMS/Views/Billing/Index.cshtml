@using UTS_SMS.Models
@model IEnumerable<SMS.ViewModels.StudentBillingViewModel>

@{
    ViewData["Title"] = "Students";
    var campusList = ViewBag.Campuses as IEnumerable<Campus>;
    var classList = ViewBag.Classes as IEnumerable<string>;
    var sectionList = ViewBag.Sections as IEnumerable<string>;
    var availableYears = ViewBag.AvailableYears as IEnumerable<int>;

    // Month names for dropdown
    var months = new Dictionary<int, string>
    {
        {1, "January"}, {2, "February"}, {3, "March"}, {4, "April"},
        {5, "May"}, {6, "June"}, {7, "July"}, {8, "August"},
        {9, "September"}, {10, "October"}, {11, "November"}, {12, "December"}
    };

    var selectedMonth = ViewData["ForMonth"] as int? ?? DateTime.Now.Month;
    var selectedYear = ViewData["ForYear"] as int? ?? DateTime.Now.Year;
    var selectedCampus = ViewData["CampusFilter"] as int?;
}

<div class="min-h-screen bg-neutral-50 p-2 md:p-6">
    <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-4 md:mb-6">
        <h1 class="text-2xl md:text-3xl font-bold text-primary-800 mb-3 md:mb-0">Fee Details</h1>

    </div>

    @if (TempData["SuccessMessage"] != null)
    {
        <div class="bg-success-light border-l-4 border-success text-success p-3 md:p-4 mb-4 md:mb-6 rounded-lg animate-fade-in text-sm">
            @TempData["SuccessMessage"]
        </div>
    }

    <!-- Filter form with improved mobile layout -->
    <form id="filterForm" asp-action="Index" method="get" class="bg-white p-3 md:p-4 rounded-xl shadow-sms-md mb-4 md:mb-6 transition-all duration-300 hover:shadow-sms-lg">
        <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-7 gap-3 md:gap-4">
            @if (campusList != null && campusList.Any())
            {
                <div class="md:col-span-1">
                    <label class="block text-sm font-medium text-neutral-700 mb-1">Campus</label>
                    <select name="campusFilter" id="campusFilter" class="w-full px-3 py-2 border border-primary-200 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-400 transition-all text-sm" id="campusFilter">
                        <option value="">All Campuses</option>
                        @foreach (var campus in campusList)
                        {
                            <option value="@campus.Id" selected="@(selectedCampus.HasValue && selectedCampus.Value == campus.Id)">@campus.Name</option>
                        }
                    </select>
                </div>
            }
         
            <div class="md:col-span-1">
                <label class="block text-sm font-medium text-neutral-700 mb-1">Class</label>
                <select name="classFilter" id="classFilter" class="w-full px-3 py-2 border border-primary-200 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-400 transition-all text-sm" id="classFilter">
                    <option value="">All Classes</option>
                    @if (classList != null)
                    {
                        foreach (var className in classList)
                        {
                            <option value="@className" selected="@(ViewData["ClassFilter"]?.ToString() == className)">@className</option>
                        }
                    }
                </select>
            </div>
            <div class="md:col-span-1">
                <label class="block text-sm font-medium text-neutral-700 mb-1">Section</label>
                <select name="sectionFilter" class="w-full px-3 py-2 border border-primary-200 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-400 transition-all text-sm" id="sectionFilter">
                    <option value="">All Sections</option>
                    @if (sectionList != null)
                    {
                        foreach (var sectionName in sectionList)
                        {
                            <option value="@sectionName" selected="@(ViewData["SectionFilter"]?.ToString() == sectionName)">@sectionName</option>
                        }
                    }
                </select>
            </div>
            <div class="sm:col-span-2 md:col-span-1">
                <label class="block text-sm font-medium text-neutral-700 mb-1">Search</label>
                <input type="text" name="searchString" value="@ViewData["CurrentFilter"]"
                       class="w-full px-3 py-2 border border-primary-200 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-400 transition-all text-sm"
                       placeholder="Name, Father, CNIC, Phone" id="searchInput" />
            </div>
            <div hidden class="md:col-span-1">
                <label class="block text-sm font-medium text-neutral-700 mb-1">Month</label>
                <select  name="forMonth" class="w-full px-3 py-2 border border-primary-200 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-400 transition-all text-sm">
                    @foreach (var month in months)
                    {
                        <option value="@month.Key" selected="@(month.Key == selectedMonth)">@month.Value</option>
                    }
                </select>
            </div>
            <div hidden class="md:col-span-1">
                <label class="block text-sm font-medium text-neutral-700 mb-1">Year</label>
                <select  name="forYear" class="w-full px-3 py-2 border border-primary-200 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-400 transition-all text-sm">
                    @if (availableYears != null)
                    {
                        foreach (var year in availableYears)
                        {
                            <option value="@year" selected="@(year == selectedYear)">@year</option>
                        }
                    }
                </select>
            </div>
            <div hidden class="sm:col-span-2 md:col-span-1">
                <label class="block text-sm font-medium text-neutral-700 mb-1">Status</label>
                <select name="showLeft"
                        class="w-full px-3 py-2 border border-primary-200 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-400 transition-all text-sm"
                        id="statusFilter">
                    <option value="">All Students</option>
                    <option value="false" selected="@(ViewData["ShowLeft"]?.ToString() == "False")">Active</option>
                    <option value="true" selected="@(ViewData["ShowLeft"]?.ToString() == "True")">Left</option>
                </select>
            </div>
        </div>
        <div class="mt-4 flex space-x-2">
            <button type="submit" class="bg-gradient-primary hover:bg-primary-700 text-white px-4 py-2 rounded-md transition-colors duration-300 text-sm">
                Apply Filters
            </button>
            <a asp-action="Index" class="bg-primary-100 hover:bg-primary-200 text-primary-800 px-4 py-2 rounded-md transition-colors duration-300 text-sm">
                Reset
            </a>
        </div>
    </form>

    <!-- Month/Year header -->
    <div class="mb-3 md:mb-4 bg-primary-50 p-2 md:p-3 rounded-lg border border-blue-200">
        <h2 class="text-base md:text-lg font-semibold text-primary-800">
            Showing fees for: @months[selectedMonth] @selectedYear
        </h2>
    </div>

    <!-- Student cards for mobile view -->
    <div class="block md:hidden">
        @foreach (var item in Model)
        {
            <div class="bg-white rounded-lg shadow-sms-md mb-4 p-4 @item.RowColor">
                <div class="flex justify-between items-start mb-3">
                    <div>
                        <h3 class="font-bold text-primary-800">@item.Student.StudentName</h3>
                        <p class="text-sm text-neutral-600">@item.Student.FatherName</p>
                        <p class="text-xs text-neutral-500 mt-1">@item.Student.Campus?.Name</p>
                    </div>
                    <div class="text-right">
                        <p class="text-sm font-medium">@item.Student.ClassObj.Name</p>
                        <p class="text-xs text-neutral-600">@item.Student.SectionObj.Name</p>
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-2 mb-3 text-sm">
                    <div>
                        <p class="text-neutral-600">Phone:</p>
                        <p>@item.Student.PhoneNumber</p>
                    </div>
                    <div>
                        <p class="text-neutral-600">Reg Date:</p>
                        <p>@item.Student.RegistrationDate.ToString("dd-MMM-yyyy")</p>
                    </div>
                </div>

                <div class="mb-3">
                    @if (item.Dues == 0)
                    {
                        <div class="flex items-center space-x-2 bg-success-light p-2 rounded-lg">
                            <div class="flex items-center justify-center w-6 h-6 bg-green-200 rounded-full">
                                <svg class="w-4 h-4 text-success" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                                </svg>
                            </div>
                            <span class="text-success font-semibold text-sm">Paid</span>
                        </div>
                    }
                    else if (item.LatestBilling == null)
                    {
                        <div class="flex items-center space-x-2 bg-error-light p-2 rounded-lg">
                            <div class="flex items-center justify-center w-6 h-6 bg-red-200 rounded-full">
                                <svg class="w-4 h-4 text-error" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
                                </svg>
                            </div>
                            <span class="text-error font-semibold text-sm">Not Paid</span>
                        </div>
                    }
                    else if (item.Dues < 0)
                    {
                        <div class="flex items-center space-x-2 bg-primary-100 p-2 rounded-lg">
                            <div class="flex items-center justify-center w-6 h-6 bg-blue-200 rounded-full">
                                <svg class="w-4 h-4 text-blue-700" fill="currentColor" viewBox="0 0 20 20">
                                    <path d="M8.433 7.418c.155-.103.346-.196.567-.267v1.698a2.305 2.305 0 01-.567-.267C8.07 8.34 8 8.114 8 8c0-.114.07-.34.433-.582zM11 12.849v-1.698c.22.071.412.164.567.267.364.243.433.468.433.582 0 .114-.07.34-.433.582a2.305 2.305 0 01-.567.267z"></path>
                                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-13a1 1 0 10-2 0v.092a4.535 4.535 0 00-1.676.662C6.602 6.234 6 7.009 6 8c0 .99.602 1.765 1.324 2.246.48.32 1.054.545 1.676.662v1.941c-.391-.127-.68-.317-.843-.504a1 1 0 10-1.51 1.31c.562.649 1.413 1.076 2.353 1.253V15a1 1 0 102 0v-.092a4.535 4.535 0 001.676-.662C13.398 13.766 14 12.991 14 12c0-.99-.602-1.765-1.324-2.246A4.535 4.535 0 0011 9.092V7.151c.391.127.68.317.843.504a1 1 0 101.511-1.31c-.563-.649-1.413-1.076-2.354-1.253V5z" clip-rule="evenodd"></path>
                                </svg>
                            </div>
                            <div class="flex flex-col">
                                <span class="text-blue-700 font-bold">₨@Math.Abs(item.Dues).ToString("N0")</span>
                                <span class="text-xs text-primary-600">Advance</span>
                            </div>
                        </div>
                    }
                    else if (item.Dues > 0) // 🎯 Explicit check for Pending
                    {
                        <div class="flex items-center space-x-2 bg-warning-light p-2 rounded-lg">
                            <div class="flex items-center justify-center w-6 h-6 bg-yellow-200 rounded-full">
                                <svg class="w-4 h-4 text-yellow-700" fill="currentColor" viewBox="0 0 20 20">
                                    <path d="M8.433 7.418c.155-.103.346-.196.567-.267v1.698a2.305 2.305 0 01-.567-.267C8.07 8.34 8 8.114 8 8c0-.114.07-.34.433-.582zM11 12.849v-1.698c.22.071.412.164.567.267.364.243.433.468.433.582 0 .114-.07.34-.433.582a2.305 2.305 0 01-.567.267z"></path>
                                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-13a1 1 0 10-2 0v.092a4.535 4.535 0 00-1.676.662C6.602 6.234 6 7.009 6 8c0 .99.602 1.765 1.324 2.246.48.32 1.054.545 1.676.662v1.941c-.391-.127-.68-.317-.843-.504a1 1 0 10-1.51 1.31c.562.649 1.413 1.076 2.353 1.253V15a1 1 0 102 0v-.092a4.535 4.535 0 001.676-.662C13.398 13.766 14 12.991 14 12c0-.99-.602-1.765-1.324-2.246A4.535 4.535 0 0011 9.092V7.151c.391.127.68.317.843.504a1 1 0 101.511-1.31c-.563-.649-1.413-1.076-2.354-1.253V5z" clip-rule="evenodd"></path>
                                </svg>
                            </div>
                            <div class="flex flex-col">
                                <span class="text-yellow-700 font-bold">₨@item.Dues.ToString("N0")</span>
                                <span class="text-xs text-accent-600">Pending</span>
                            </div>
                        </div>
                    }
                    else
                    {
                        <div class="text-sm text-center text-gray-500">Error/Undefined State</div>
                    }
                </div>

                <div class="flex justify-end">
                    @if (item.CanPay)
                    {
                        <a asp-action="Create"
                           asp-route-id="@item.Student.Id"
                           asp-route-forMonth="@selectedMonth"
                           asp-route-forYear="@selectedYear"
                           class="text-primary-600 hover:text-primary-800 bg-primary-50 p-2 rounded-full hover:bg-primary-100 transition-all duration-300 transform hover:scale-110 relative group"
                           title="Create Billing">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24" class="h-5 w-5">
                                <path fill-rule="evenodd" d="M6 2a1 1 0 00-1 1v18a1 1 0 001.555.832L9 20.25l2.445 1.582a1 1 0 001.11 0L15 20.25l2.445 1.582A1 1 0 0019 21V3a1 1 0 00-1-1H6zm3.75 6a.75.75 0 000 1.5h4.5a.75.75 0 000-1.5h-4.5zm0 4.5a.75.75 0 000 1.5h4.5a.75.75 0 000-1.5h-4.5z" clip-rule="evenodd" />
                            </svg>
                        </a>
                    }
                    else
                    {
                        <div class="flex items-center justify-center w-9 h-9 bg-success-light rounded-full">
                            <svg class="w-5 h-5 text-success" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    }
                </div>
            </div>
        }
    </div>

    <!-- Table for desktop view -->
    <div class="hidden md:block bg-white rounded-xl shadow-sms-md overflow-hidden transition-all duration-300 hover:shadow-sms-xl">
        <div class="">
            <table class="min-w-full divide-y divide-primary-100">
                <thead class="bg-gradient-dark text-white">
                    <tr>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider">
                            <a asp-action="Index"
                               asp-route-sortOrder="@ViewData["NameSortParm"]"
                               asp-route-currentFilter="@ViewData["CurrentFilter"]"
                               asp-route-campusFilter="@ViewData["CampusFilter"]"
                               asp-route-classFilter="@ViewData["ClassFilter"]"
                               asp-route-sectionFilter="@ViewData["SectionFilter"]"
                               asp-route-showLeft="@ViewData["ShowLeft"]"
                               class="hover:text-accent-400 transition-colors duration-200">
                                Name
                            </a>
                        </th>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider">Father Name</th>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider">Campus</th>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider">
                            <a asp-action="Index"
                               asp-route-sortOrder="@ViewData["ClassSortParm"]"
                               asp-route-currentFilter="@ViewData["CurrentFilter"]"
                               asp-route-campusFilter="@ViewData["CampusFilter"]"
                               asp-route-classFilter="@ViewData["ClassFilter"]"
                               asp-route-sectionFilter="@ViewData["SectionFilter"]"
                               asp-route-showLeft="@ViewData["ShowLeft"]"
                               class="hover:text-accent-400 transition-colors duration-200">
                                Class
                            </a>
                        </th>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider">Section</th>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider">Phone</th>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider">
                            <a asp-action="Index"
                               asp-route-sortOrder="@ViewData["DateSortParm"]"
                               asp-route-currentFilter="@ViewData["CurrentFilter"]"
                               asp-route-campusFilter="@ViewData["CampusFilter"]"
                               asp-route-classFilter="@ViewData["ClassFilter"]"
                               asp-route-sectionFilter="@ViewData["SectionFilter"]"
                               asp-route-showLeft="@ViewData["ShowLeft"]"
                               class="hover:text-accent-400 transition-colors duration-200">
                                Reg Date
                            </a>
                        </th>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider">Dues</th>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider">Actions</th>
                    </tr>
                </thead>
                <tbody class="bg-white divide-y divide-primary-100">
                    @foreach (var item in Model)
                    {
                        <tr class="@item.RowColor transition-all duration-300 hover:shadow-sms-lg hover:scale-[1.02] transform">
                            <td class="px-6 py-4 whitespace-normal break-words text-sm font-medium text-primary-800 max-w-[200px]">
                                @item.Student.StudentName
                            </td>

                            <td class="px-6 py-4 whitespace-normal break-words text-sm text-neutral-500 max-w-[150px]">
                                @item.Student.FatherName
                            </td>

                            <td class="px-6 py-4 whitespace-normal text-sm text-neutral-500">
                                @item.Student.Campus?.Name
                            </td>

                            <td class="px-6 py-4 whitespace-normal text-sm text-neutral-500">
                                @item.Student.ClassObj.Name
                            </td>

                            <td class="px-6 py-4 whitespace-normal text-sm text-neutral-500">
                                @item.Student.SectionObj.Name
                            </td>

                            <td class="px-6 py-4 whitespace-nowrap text-sm text-neutral-500">
                                @item.Student.PhoneNumber
                            </td>

                            <td class="px-6 py-4 whitespace-nowrap text-sm text-neutral-500">
                                @item.Student.RegistrationDate.ToString("dd-MMM-yyyy")
                            </td>

                            <td class="px-6 py-4 whitespace-nowrap text-sm">
                                @if (item.Dues == 0)
                                {
                                    <div class="flex items-center space-x-2">
                                        <div class="flex items-center justify-center w-8 h-8 bg-success-light rounded-full">
                                            <svg class="w-5 h-5 text-success" fill="currentColor" viewBox="0 0 20 20">
                                                <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                                            </svg>
                                        </div>
                                        <span class="text-success font-semibold">Paid</span>
                                    </div>
                                }
                                else if (item.LatestBilling == null)
                                {
                                    <div class="flex items-center space-x-2">
                                        <div class="flex items-center justify-center w-8 h-8 bg-error-light rounded-full">
                                            <svg class="w-5 h-5 text-error" fill="currentColor" viewBox="0 0 20 20">
                                                <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
                                            </svg>
                                        </div>
                                        <span class="text-error font-semibold">Not Paid</span>
                                    </div>
                                }
                                else if (item.Dues > 0)
                                {
                                    <div class="flex items-center space-x-2">
                                        <div class="flex items-center justify-center w-8 h-8 bg-warning-light rounded-full">
                                            <svg class="w-5 h-5 text-accent-600" fill="currentColor" viewBox="0 0 20 20">
                                                <path d="M8.433 7.418c.155-.103.346-.196.567-.267v1.698a2.305 2.305 0 01-.567-.267C8.07 8.34 8 8.114 8 8c0-.114.07-.34.433-.582zM11 12.849v-1.698c.22.071.412.164.567.267.364.243.433.468.433.582 0 .114-.07.34-.433.582a2.305 2.305 0 01-.567.267z"></path>
                                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-13a1 1 0 10-2 0v.092a4.535 4.535 0 00-1.676.662C6.602 6.234 6 7.009 6 8c0 .99.602 1.765 1.324 2.246.48.32 1.054.545 1.676.662v1.941c-.391-.127-.68-.317-.843-.504a1 1 0 10-1.51 1.31c.562.649 1.413 1.076 2.353 1.253V15a1 1 0 102 0v-.092a4.535 4.535 0 001.676-.662C13.398 13.766 14 12.991 14 12c0-.99-.602-1.765-1.324-2.246A4.535 4.535 0 0011 9.092V7.151c.391.127.68.317.843.504a1 1 0 101.511-1.31c-.563-.649-1.413-1.076-2.354-1.253V5z" clip-rule="evenodd"></path>
                                            </svg>
                                        </div>
                                        <div class="flex flex-col">
                                            <span class="text-yellow-700 font-bold text-lg">₨@item.Dues.ToString("N0")</span>
                                            <span class="text-xs text-accent-600">Pending</span>
                                        </div>
                                    </div>
                                }
                                else
                                {
                                    <div class="flex items-center space-x-2">
                                        <div class="flex items-center justify-center w-8 h-8 bg-warning-light rounded-full">
                                            <svg class="w-5 h-5 text-accent-600" fill="currentColor" viewBox="0 0 20 20">
                                                <path d="M8.433 7.418c.155-.103.346-.196.567-.267v1.698a2.305 2.305 0 01-.567-.267C8.07 8.34 8 8.114 8 8c0-.114.07-.34.433-.582zM11 12.849v-1.698c.22.071.412.164.567.267.364.243.433.468.433.582 0 .114-.07.34-.433.582a2.305 2.305 0 01-.567.267z"></path>
                                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-13a1 1 0 10-2 0v.092a4.535 4.535 0 00-1.676.662C6.602 6.234 6 7.009 6 8c0 .99.602 1.765 1.324 2.246.48.32 1.054.545 1.676.662v1.941c-.391-.127-.68-.317-.843-.504a1 1 0 10-1.51 1.31c.562.649 1.413 1.076 2.353 1.253V15a1 1 0 102 0v-.092a4.535 4.535 0 001.676-.662C13.398 13.766 14 12.991 14 12c0-.99-.602-1.765-1.324-2.246A4.535 4.535 0 0011 9.092V7.151c.391.127.68.317.843.504a1 1 0 101.511-1.31c-.563-.649-1.413-1.076-2.354-1.253V5z" clip-rule="evenodd"></path>
                                            </svg>
                                        </div>
                                        <div class="flex flex-col">
                                            <span class="text-blue-700 font-bold text-lg">₨@Math.Abs(item.Dues).ToString("N0")</span>
                                            <span class="text-xs text-accent-600">Advance</span>
                                        </div>
                                    </div>
                                }
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-neutral-500">
                                <div class="flex space-x-2">
                                    @if (item.CanPay)
                                    {
                                        <a asp-action="Create"
                                           asp-route-id="@item.Student.Id"
                                           asp-route-forMonth="@selectedMonth"
                                           asp-route-forYear="@selectedYear"
                                           class="text-primary-600 hover:text-primary-800 bg-primary-50 p-2 rounded-full hover:bg-primary-100 transition-all duration-300 transform hover:scale-110 relative group"
                                           title="Create Billing">
                                            <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24" class="h-5 w-5">
                                                <path fill-rule="evenodd" d="M6 2a1 1 0 00-1 1v18a1 1 0 001.555.832L9 20.25l2.445 1.582a1 1 0 001.11 0L15 20.25l2.445 1.582A1 1 0 0019 21V3a1 1 0 00-1-1H6zm3.75 6a.75.75 0 000 1.5h4.5a.75.75 0 000-1.5h-4.5zm0 4.5a.75.75 0 000 1.5h4.5a.75.75 0 000-1.5h-4.5z" clip-rule="evenodd" />
                                            </svg>
                                            <span class="absolute -top-8 left-1/2 transform -translate-x-1/2 bg-gradient-dark text-white text-xs px-2 py-1 rounded opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap">
                                                Create Billing
                                            </span>
                                        </a>
                                    }
                                    else
                                    {
                                        <div class="flex items-center justify-center w-9 h-9 bg-success-light rounded-full">
                                            <svg class="w-5 h-5 text-success" fill="currentColor" viewBox="0 0 20 20">
                                                <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                                            </svg>
                                        </div>
                                    }
                                </div>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>

    <!-- Legend for row colors -->
    <div class="mt-4 md:mt-6 bg-white p-3 md:p-4 rounded-lg shadow-sms-md">
        <h3 class="text-base md:text-lg font-semibold text-primary-800 mb-2 md:mb-3">Payment Status Legend</h3>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-3 md:gap-4">
            <div class="flex items-center space-x-3">
                <div class="w-4 h-4 md:w-6 md:h-6 bg-success-light border border-green-200 rounded"></div>
                <span class="text-xs md:text-sm text-neutral-700">Fees Paid (No dues)</span>
            </div>
            <div class="flex items-center space-x-3">
                <div class="w-4 h-4 md:w-6 md:h-6 bg-warning-light border border-yellow-200 rounded"></div>
                <span class="text-xs md:text-sm text-neutral-700">Fees Pending (Has dues)</span>
            </div>
            <div class="flex items-center space-x-3">
                <div class="w-4 h-4 md:w-6 md:h-6 bg-error-light border border-red-200 rounded"></div>
                <span class="text-xs md:text-sm text-neutral-700">No Billing Record</span>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <link rel="stylesheet" href="~/css/site.css" asp-append-version="true" /> 
    <link href="~/css/fontawesome.css" rel="stylesheet" /> 
    <script src="~/js/jquery.js"></script>
    <script>
        $(document).ready(function() {
            var typingTimer;
            var doneTypingInterval = 500;

            var filterElements = ['#searchInput', '#campusFilter', '#classFilter', '#sectionFilter', '#statusFilter',
                     'select[name="forMonth"]', 'select[name="forYear"]'];

            $(filterElements.join(',')).on('input change', function() {
                clearTimeout(typingTimer);

                if ($(this).is('#searchInput')) {
                    typingTimer = setTimeout(submitForm, doneTypingInterval);
                } else {
                    submitForm();
                }
            });

              function submitForm() {
                  $('#filterForm').submit();
              }

            // Update class dropdown when campus changes
            $('#campusFilter').change(function() {
                var campusId = $(this).val();
                $.get('/Students/GetClassesByCampus', { campusId: campusId }, function(data) {
                    $('#classFilter').empty();
                    $('#classFilter').append($('<option>', { value: '', text: 'All Classes' }));
                    $.each(data, function(index, item) {
                        $('#classFilter').append($('<option>', { value: item, text: item }));
                    });
                });
            });

            // Update section dropdown when class changes
            $('#classFilter').change(function() {
                var className = $(this).val();
                $.get('/Students/GetSectionsByClass', { className: className }, function(data) {
                    $('#sectionFilter').empty();
                    $('#sectionFilter').append($('<option>', { value: '', text: 'All Sections' }));
                    $.each(data, function(index, item) {
                        $('#sectionFilter').append($('<option>', { value: item, text: item }));
                    });
                });
            });

            // Set initial values
            $('#campusFilter').val('@ViewData["CampusFilter"]');
            $('#classFilter').val('@ViewData["ClassFilter"]');
            $('#sectionFilter').val('@ViewData["SectionFilter"]');
            $('#statusFilter').val('@ViewData["ShowLeft"]');
        });
    </script>
    <style>
        .animate-fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }

        @@keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        tr {
            transition: all 0.3s ease;
        }

        .bg-success-light:hover {
            background-color: rgb(187 247 208) !important;
        }

        .bg-warning-light:hover {
            background-color: rgb(254 240 138) !important;
        }

        .bg-error-light:hover {
            background-color: rgb(254 202 202) !important;
        }

        /* Pulse animation for pending dues */
        .bg-warning-light .text-yellow-700 {
            animation: pulse 2s infinite;
        }

        @@keyframes pulse {
            0%, 100% {
                opacity: 1;
            }

            50% {
                opacity: 0.7;
            }
        }

        /* Ensure table fits on mobile */
        .overflow-x-auto {
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }

        /* Prevent horizontal scrolling on mobile */
        @@media (max-width: 767px) {
            .min-h-screen

        {
            overflow-x: hidden;
        }

        }
    </style>
}
