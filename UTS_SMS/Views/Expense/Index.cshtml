@model IEnumerable<Expense>

@{
    ViewData["Title"] = "Monthly Expenses";
    var campusList = ViewBag.Campuses as IEnumerable<dynamic>;
    var currentMonth = (int)ViewBag.CurrentMonth;
    var currentYear = (int)ViewBag.CurrentYear;
    var totalExpenses = (decimal)ViewBag.TotalExpenses;
    var monthOptions = ViewBag.MonthOptions as IEnumerable<dynamic>;
    var yearOptions = ViewBag.YearOptions as IEnumerable<dynamic>;
}

<div class="min-h-screen  p-4 md:p-6">
    <div class="max-w-7xl mx-auto">
        <!-- Header -->
        <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6">
            <div>
                <h1 class="text-3xl font-bold text-primary-800">Monthly Expenses</h1>
                <p class="text-neutral-600 mt-2">Manage and track school expenses by month</p>
            </div>
            <a asp-action="Create" class="bg-gradient-primary hover:shadow-sms-lg text-white px-4 py-2 rounded-lg transition-all duration-300 flex items-center shadow-sms-md mt-4 md:mt-0">
                <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                </svg>
                Add New Expense
            </a>
        </div>

    <!-- Month/Year Filter -->
    <div class="bg-white p-4 md:p-6 rounded-lg shadow-sm mb-6">
        <form method="get" class="grid grid-cols-1 md:grid-cols-4 gap-4">
            <div>
                <label for="month" class="block text-sm font-medium text-neutral-700 mb-1">Month</label>
                <select name="month" id="month" class="w-full px-3 py-2 border border-primary-200 rounded-lg focus:ring-2 focus:ring-primary-400 focus:border-primary-400 text-sm">
                    @foreach (var monthOption in monthOptions)
                    {
                        <option value="@monthOption.Value" selected="@(monthOption.Value == currentMonth)">
                            @monthOption.Text
                        </option>
                    }
                </select>

            </div>
            
            <div>
                <label for="year" class="block text-sm font-medium text-neutral-700 mb-1">Year</label>
                <select name="year" id="year" class="w-full px-3 py-2 border border-primary-200 rounded-lg focus:ring-2 focus:ring-primary-400 focus:border-primary-400 text-sm">
                    @foreach (var yearOption in yearOptions)
                    {
                        <option value="@yearOption.Value" selected="@(yearOption.Value == currentYear)">
                            @yearOption.Text
                        </option>
                    }
                </select>


            </div>

            @if (campusList?.Count() > 1)
            {
                <div>
                    <label for="campus-filter" class="block text-sm font-medium text-neutral-700 mb-1">Campus</label>
                    <select id="campus-filter" name="campusFilter" class="w-full px-3 py-2 border border-primary-200 rounded-lg focus:ring-2 focus:ring-primary-400 focus:border-primary-400 text-sm">
                        <option value="">All Campuses</option>
                        @foreach (var campus in campusList)
                        {
                            <option value="@campus.Id">@campus.Name</option>
                        }
                    </select>
                </div>
            }

            <div class="flex items-end">
                <button type="submit" class="w-full bg-gradient-primary hover:bg-primary-700 text-white px-4 py-2 rounded-lg transition-all duration-300 text-sm">
                    Filter
                </button>
            </div>
        </form>
    </div>

    <!-- Summary Cards -->
    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
        <div class="bg-white rounded-lg shadow-sm p-6">
            <div class="flex items-center">
                <div class="flex-shrink-0">
                    <div class="w-8 h-8 bg-error-light rounded-lg flex items-center justify-center">
                        <svg class="w-5 h-5 text-error" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"></path>
                        </svg>
                    </div>
                </div>
                <div class="ml-5 w-0 flex-1">
                    <dl>
                        <dt class="text-sm font-medium text-neutral-500 truncate">Total Expenses</dt>
                        <dd class="text-lg font-medium text-primary-800">@totalExpenses.ToString("C")</dd>
                    </dl>
                </div>
            </div>
        </div>

        <div class="bg-white rounded-lg shadow-sm p-6">
            <div class="flex items-center">
                <div class="flex-shrink-0">
                    <div class="w-8 h-8 bg-primary-100 rounded-lg flex items-center justify-center">
                        <svg class="w-5 h-5 text-primary-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 12l3-3 3 3 4-4M8 21l4-4 4 4M3 4h18M4 4h16v12a1 1 0 01-1 1H5a1 1 0 01-1-1V4z"></path>
                        </svg>
                    </div>
                </div>
                <div class="ml-5 w-0 flex-1">
                    <dl>
                        <dt class="text-sm font-medium text-neutral-500 truncate">Number of Expenses</dt>
                        <dd class="text-lg font-medium text-primary-800">@Model.Count()</dd>
                    </dl>
                </div>
            </div>
        </div>

        <div class="bg-white rounded-lg shadow-sm p-6">
            <div class="flex items-center">
                <div class="flex-shrink-0">
                    <div class="w-8 h-8 bg-success-light rounded-lg flex items-center justify-center">
                        <svg class="w-5 h-5 text-success" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                        </svg>
                    </div>
                </div>
                <div class="ml-5 w-0 flex-1">
                    <dl>
                        <dt class="text-sm font-medium text-neutral-500 truncate">Average Expense</dt>
                        <dd class="text-lg font-medium text-primary-800">
                            @(Model.Any() ? (totalExpenses / Model.Count()).ToString("C") : "$0.00")
                        </dd>
                    </dl>
                </div>
            </div>
        </div>

        <div class="bg-white rounded-lg shadow-sm p-6">
            <div class="flex items-center">
                <div class="flex-shrink-0">
                    <div class="w-8 h-8 bg-purple-100 rounded-lg flex items-center justify-center">
                        <svg class="w-5 h-5 text-primary-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                        </svg>
                    </div>
                </div>
                <div class="ml-5 w-0 flex-1">
                    <dl>
                        <dt class="text-sm font-medium text-neutral-500 truncate">Largest Expense</dt>
                        <dd class="text-lg font-medium text-primary-800">
                            @(Model.Any() ? Model.Max(e => e.Amount).ToString("C") : "$0.00")
                        </dd>
                    </dl>
                </div>
            </div>
        </div>
    </div>

    <!-- Expenses Table -->
    <div class="bg-white rounded-lg shadow-sm overflow-hidden">
        <!-- Desktop Table View -->
        <div class="hidden md:block overflow-x-auto">
            <table class="w-full">
                <thead class="bg-neutral-50">
                    <tr>
                        <th class="px-6 py-3 text-left text-xs font-medium text-neutral-500 uppercase tracking-wider">Expense Name</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-neutral-500 uppercase tracking-wider">Category</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-neutral-500 uppercase tracking-wider">Amount</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-neutral-500 uppercase tracking-wider">Date</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-neutral-500 uppercase tracking-wider">Account</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-neutral-500 uppercase tracking-wider">Campus</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-neutral-500 uppercase tracking-wider">Actions</th>
                    </tr>
                </thead>
                <tbody class="bg-white divide-y divide-primary-100">
                    @foreach (var expense in Model)
                    {
                        <tr class="hover:bg-neutral-50">
                            <td class="px-6 py-4 whitespace-nowrap">
                                <div class="text-sm font-medium text-primary-800">@expense.Name</div>
                                @if (!string.IsNullOrEmpty(expense.Reference))
                                {
                                    <div class="text-sm text-neutral-500">Ref: @expense.Reference</div>
                                }
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                @if (!string.IsNullOrEmpty(expense.Category))
                                {
                                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-primary-100 text-primary-800">
                                        @expense.Category
                                    </span>
                                }
                                else
                                {
                                    <span class="text-neutral-500">-</span>
                                }
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm font-semibold text-error">@expense.Amount.ToString("C")</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-primary-800">@expense.ExpenseDate.ToString("MMM dd, yyyy")</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-primary-800">@(expense.Account?.AccountTitle ?? "N/A")</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-primary-800">@expense.Campus?.Name</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                <div class="flex space-x-2">
                                    <a asp-action="Details" asp-route-id="@expense.Id" 
                                       class="text-primary-600 hover:text-primary-800 transition-colors duration-300">Details</a>
                                    <a asp-action="Edit" asp-route-id="@expense.Id" 
                                       class="text-info hover:text-indigo-900 transition-colors duration-300">Edit</a>
                                </div>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>

        <!-- Mobile Card View -->
        <div class="md:hidden space-y-4 p-4">
            @foreach (var expense in Model)
            {
                <div class="bg-white border border-primary-100 rounded-lg p-4 shadow-sm">
                    <div class="flex justify-between items-start mb-3">
                        <div class="flex-1">
                            <h3 class="font-semibold text-primary-800">@expense.Name</h3>
                            @if (!string.IsNullOrEmpty(expense.Reference))
                            {
                                <p class="text-sm text-neutral-500">Ref: @expense.Reference</p>
                            }
                        </div>
                        <div class="text-right">
                            <div class="text-lg font-semibold text-error">@expense.Amount.ToString("C")</div>
                            @if (!string.IsNullOrEmpty(expense.Category))
                            {
                                <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-primary-100 text-primary-800 mt-1">
                                    @expense.Category
                                </span>
                            }
                        </div>
                    </div>
                    
                    <div class="space-y-2 mb-4">
                        <div class="text-sm text-neutral-600">
                            <span class="font-medium">Date:</span> @expense.ExpenseDate.ToString("MMM dd, yyyy")
                        </div>
                        <div class="text-sm text-neutral-600">
                            <span class="font-medium">Account:</span> @(expense.Account?.AccountTitle ?? "N/A")
                        </div>
                        <div class="text-sm text-neutral-600">
                            <span class="font-medium">Campus:</span> @expense.Campus?.Name
                        </div>
                        @if (!string.IsNullOrEmpty(expense.Description))
                        {
                            <div class="text-sm text-neutral-600">
                                <span class="font-medium">Description:</span> @expense.Description.Substring(0, Math.Min(50, expense.Description.Length))@(expense.Description.Length > 50 ? "..." : "")
                            </div>
                        }
                    </div>
                    
                    <div class="flex space-x-2">
                        <a asp-action="Details" asp-route-id="@expense.Id" 
                           class="flex-1 bg-gradient-primary hover:bg-primary-700 text-white text-center py-2 px-4 rounded-lg text-sm transition-all duration-300">
                            Details
                        </a>
                        <a asp-action="Edit" asp-route-id="@expense.Id" 
                           class="flex-1 bg-indigo-600 hover:bg-indigo-700 text-white text-center py-2 px-4 rounded-lg text-sm transition-all duration-300">
                            Edit
                        </a>
                    </div>
                </div>
            }
        </div>

        @if (!Model.Any())
        {
            <div class="text-center py-12">
                <svg class="mx-auto h-12 w-12 text-neutral-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"></path>
                </svg>
                <h3 class="mt-2 text-sm font-medium text-primary-800">No expenses found</h3>
                <p class="mt-1 text-sm text-neutral-500">Get started by adding a new expense for this month.</p>
                <div class="mt-6">
                    <a asp-action="Create" 
                       class="inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-gradient-primary hover:bg-primary-700">
                        Add New Expense
                    </a>
                </div>
            </div>
        }
</div>